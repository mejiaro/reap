<%= content = capture do %>
  <%= turbo_frame_tag :modal do %>
    <%= form_with(model: time_reg, id: dom_id(time_reg)) do |form| %>
      <%= render Dialog::Base.new(title: "New time entry", subtitle: format_date(Date.today), open: true) do |d| %>
        <%= d.with_body do %>
          <%= content_tag(:div, class: "w-full flex flex-col mb-8") do %>
            <div class="block" data-controller="time-tasks">
              <%= hidden_field_tag :date, chosen_date %>
              <div class="mb-4" data-time-tasks-target="project">
                <%= form.label :project_id, class: 'block text-gray-700 text-sm font-bold mb-2' %>
                <%= form.collection_select :project_id, projects, :id, :name, {
                  include_blank: "select a project:",
                  selected: time_reg.project&.id
                }, {
                                             class: 'w-full rounded-md p-2 border border-gray-300 focus:ring-1 focus:ring-seaGreenDark focus:border-seaGreenDark ring-offset-1 ring-offset-white'
                                           } %>
                <% time_reg.errors.full_messages_for(:membership).any? do |message| %>
                  <div class="text-red-600 text-xs italic mt-1">Please select a project</div>
                <% end %>
              </div>

              <div class="mb-4" data-time-tasks-target="task">
                <%= form.label :assigned_task_id, class: 'block text-gray-700 text-sm font-bold mb-2' %>
                <%= form.collection_select :assigned_task_id, (time_reg.project&.tasks || [] ), :id, :name, {
                  selected: time_reg.assigned_task&.id }, {
                                             class: 'w-full rounded-md p-2 border border-gray-300 focus:ring-1 focus:ring-seaGreenDark focus:border-seaGreenDark ring-offset-1 ring-offset-white'
                                           } %>
                <% time_reg.errors.full_messages_for(:assigned_task_id).each do |message| %>
                  <div class="text-red-600 italic text-xs mt-1">Please select a task</div>
                <% end %>
              </div>

              <div class="mb-4">
                <%= form.label :notes, class: 'block text-gray-700 text-sm font-bold mb-2' %>
                <% time_reg.errors.full_messages_for(:notes).each do |message| %>
                  <div  class="text-red-600 text-xs italic mt-1"><%= message %></div>
                <% end %>
                <%= form.text_area :notes, class: 'w-full rounded-md p-2 border border-gray-300 focus:ring-1 focus:ring-seaGreenDark focus:border-seaGreenDark ring-offset-1 ring-offset-white' %>
              </div>

              <%= content_tag :div, data: { controller: "input", "input-active_text_value": "Create Time reg", "input-inactive_text_value": "Start timer" } do %>
                <%= form.label :minutes, "Time", class: 'block text-gray-700 text-sm font-bold mb-2' %>
                <% time_reg.errors.full_messages_for(:minutes).each do |message| %>
                  <div class="text-red-600 italic text-xs mt-1" data-refresh-minutes-target="output"><%= message %></div>
                <% end %>
                <%= form.hidden_field :minutes, data: { "input-target": "clone" } %>
                <%= form.text_field :minutes_string, placeholder: "0:00", type: "time", autocomplete: "off", data: {
                  action: "input#cloneValue"
                }, value: convert_time_int(time_reg.minutes),
                                    class: 'text-end w-full rounded-md p-2 border border-gray-300 focus:ring-1 focus:ring-seaGreenDark focus:border-seaGreenDark ring-offset-1 ring-offset-white'
                %>
                <%= form.hidden_field :date_worked %>
              <% end %>
            </div>
          <% end %>
        <% end %>
        <%= d.with_footer do %>
          <%= button_tag type: 'button', data: {action: "dialog#close click@window->dialog#closeBackground"}, class: "" do %>
            Cancel
          <% end %>
          <%= form.submit "Confirm", class: "bg-indigo-600 p-4 rounded-md" %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<%= turbo_stream.replace(:modal, content) %>
